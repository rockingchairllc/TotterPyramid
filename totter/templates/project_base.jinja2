{% extends "page_base.jinja2" %}

{# navigation_bar elements: (url, id, caption) #}
{% set navigation_bar = [
    
    (request.model_url(context), 'overview', 'Overview'),
    (request.model_url(context, 'ideas'), 'ideas', 'Ideas'),
    (request.model_url(context, 'people'), 'people', 'People'),
    (request.model_url(context, 'invite'), 'invite', 'Invite')
] -%}

{% set active_page = active_page|default('overview') -%}
{% block scripts %}
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js"></script>
<script src="{{request.static_url('totter:static/js/jquery.jeditable.js')}}" type="text/javascript" charset="utf-8"></script>
<script src="{{request.static_url('totter:static/js/jquery.autoresize.js')}}"></script>
<script src="{{request.static_url('totter:static/js/jquery.jeditable.autoresize.js')}}"></script>
<script type="text/javascript">
(function($) {
        $(document).ready(function(){
            $('.edit').editable('{{request.model_url(context)}}');
            $('.edit_area').editable('{{request.model_url(context)}}', { 
                 type      : 'autoResize',
                 cancel    : 'Cancel',
                 submit    : 'OK',
                 indicator : '<img src="{{request.static_url('totter:static/images/indicator.gif')}}">',
                 tooltip   : 'Click to edit...',
                 autoResize: {}
             });
             
        });
                    
        function addIdea() {
			$('.add_idea').toggle();
		}
	    function addIdea_to_project() {
			var prjId = "{{project.id}}";
			var IdeaData = JSON.stringify({'data': $(".add_idea_modal textarea").val(), 'project_id': prjId });
			$.ajax({
				url:"{{request.application_url}}/project/{{project.id}}/idea",
				type: "POST",
				dataType: "json",
				data: IdeaData,
				success: onSuccess_addIdea
			});
			
			$(".add_idea .throbber").removeClass('hidden');
			$(".add_idea button").addClass('hidden');
			
			function onSuccess_addIdea(data){
			    // Successfully added our idea to the serverside.
			    var new_id = data.idea_id;
				$('.project_ideas').load(location.href + " .project_ideas>*", function() {
				    addIdea();
				    $('html,body').animate({scrollTop: $("#idea_"+new_id).offset().top},'fast');
				    $(".add_idea .throbber").addClass('hidden');
			        $(".add_idea button").removeClass('hidden');
			        
			        $(document).ready(function(){
                        $('.comment_text').bind('keypress', submitkey_binding);
                    });
				});
				
				/*
				var prepare_data = '<li><div class="idea_author"><a href="#"><img src={{user.profile_picture}}?type=square"/></a></div>' +
                    '<div class="idea_body"><div class="idea_meta"><div class="username"><a href="#">{{user.first_name}}</a></div>' +
	                '<strong id="rate_value'+new_id+'">Total Rating: 0</strong><div class="like_love">' +
	                '<a href="#" id="likeidea'+new_id+'" order="1" onClick="addRating(' + new_id + ', 0, 1)">Like It</a> &bull; <a href="#" id="loveidea'+new_id+'" order="1" onClick="addRating(' + new_id + ', 0, 2)">Love It</a>' + 
	                '</div><!-- like_love --></div><!-- .idea_meta --><div class="idea_description">'+ $(".add_idea_modal textarea").val() +'</div><div class="comment_time">' +
                    '<a href="javascript:void(0)" class="comment_on_idea" onClick="showComment('+new_id+')">Comment</a>&#124;September 18th at 9:30am</div><!-- .comment_time -->' +
                    '<ul class="project_idea_comments" id="comments'+new_id+'"><li class="new_comment first_update"><input class="comment_text" type="text" value="Start Typing" order="'+new_id+'"/><br /><span class="enter_to_submit">Push Enter to Submit</span>' +
                    '</li><!-- .new_comment --><!-- Append all new comments to the ul.project_idea_comments --></ul><!-- .project_idea_comments --></div><!-- idea_body --></li>';
                $('.project_ideas').prepend(prepare_data);
                $('#comments'+new_id).children('.new_comment').children('.comment_text').bind('keypress', submitkey_binding);*/
			}
			
		}
})(jQuery);
</script>
{% endblock %}
{% block page_body %}
            {% block project_header %}
            <!-- Add Idea and Modal Overlay -->
            <div class="add_idea">
                <div class="add_idea_overlay" onClick="addIdea()"></div>
                <div class="add_idea_modal drop-shadow">
                    <h1>Add Idea</h1>
                    <textarea>Start typing your idea...</textarea>
                    <a href="javascript:void(0)" onClick="addIdea()">Cancel</a>
                    <div class="throbber hidden">
                        <span>Posting...</span>
                        <img src="{{request.static_url('totter:static/images/throbber.gif')}}"/>
                    </div>
                    <button type="button" onClick="addIdea_to_project()">Add Idea</button>
                </div><!-- idea_idea_modal -->
            </div><!-- .add_idea -->
            
            <script>
			function addIdea() {
				$('.add_idea').toggle();
			}
			</script>
            <!-- END Add Idea and Modal Overlay -->
            
            <!-- Begin the main content. -->
            <h1 id="title" class="title {%if editable %}edit{% endif %}">{{project.title}}</h1> 
            <h3>by <a href="#">{{project.creator.first_name}} {{project.creator.last_name}}</a></h3>
            
            <div class="the_content">
                <ul class="tabs">
                    {# Build tabs from navigation_bar data. #}
                    {% for href, id, caption in navigation_bar %}
                    <li>
                        <a href="{{ href|e }}" {%if id == active_page %}class="active_tab"{% endif %}>
                        {{ caption|e }}
                        </a>
                    </li>
                    {% endfor %}
                </ul><!-- .tabs -->
                <ul class="project_stats">
                    <li>
                        People<br />
                        <span class="project_stat">{{people_count}}</span>
                    </li>
                    <li>
                        Ideas<br />
                        <span class="project_stat">{{ideas_count}}</span>
                    </li>
                    <li>
                        Deadline<br />
                        <span class="project_stat">{{project.deadline}}</span>
                    </li>
                    <button type="button" onClick="addIdea()" class="add_idea_button">Add Idea</button>
                </ul><!-- .project_stats -->
            {% endblock %}
            {% block project_body %}
            {% endblock %}
            </div><!-- .the_content -->
{% endblock %}